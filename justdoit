#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <locale.h>

int VerificaCarac(char * str);

void ImprimeCreditos(void);


int main(){
    //Os dialogos anteriores podiam sumir :/
    //como?
    setlocale(LC_ALL, "");
    char entry;
    //menu do jogo?
    //JOGAR ->
    //tela preta que vai ficando mais clara

    system("cls"); //limpa terminal

    //passaro fala:
    printf("???: Ei, voce finalmente acordou.\n");
    printf("???: Tudo bem, e dificil no comeco, voce pode pressionar qualquer tecla seguida do \"Enter\" para continuar.\n");
    scanf("%c", &entry); //IDEIA-----NAO PRECISAR DO ENTER PARA CONTINUAR, APENAS O CARACTER-----REPETE-SE-----//

    system("cls"); //limpa terminal

    printf("???: Otimo.\n");

    printf("\n");

    printf("???: Acho que estou com fome, que tal prepararmos alguma coisa?\n");

    char **dialogo;
    int j;

    // aloca um vetor de LIN ponteiros para linhas
    dialogo = malloc(sizeof(char*)*5);

    // aloca um vetor com todos os elementos da matriz
    for(j=0;j<5;j++) dialogo[j]=malloc(sizeof(char)*1000);
    

    dialogo[0] = "0";
    dialogo[1] = "(1) Calmai! O que e voce?\n(2) Calmai! Quem e voce?";
    dialogo[2] = "???: Nossa, \"o que sou eu\"? Isso doeu...";
    dialogo[3] = "???: Bem... isso e complicado...";

    
    int i = 1, d;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 2 || i == 3) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                break;
        }
               

    }
        for(j=0;j<5;j++)free(dialogo[j]);

        free(dialogo);
    


    i = d = 1;

    printf("???: Por enquanto, sou apenas um passaro que ira te acompanhar em sua jornada.\n");


    dialogo = calloc(8, sizeof(char*));

    for(j=0;j<8;j++)dialogo[j] = calloc(1000, sizeof(char));


    dialogo[0] = "0"; 
    dialogo[1] = "???: Mas entao, vamos fazer (1)tapioca ou (2)pao?"; 
    dialogo[2] = "???: Hum, ok, tapioca com (1)presunto e queijo ou (2)banana?"; //tapioca
    dialogo[3] = "???: Pao! Adoro! (1)Presunto e queijo ou com (2)carne?"; //pao
    dialogo[4] = "???: Deixa eu experimentar... Tapioca com presunto e queijo ta muito boa!"; //tapioca p. e q.
    dialogo[5] = "???: Tapioca com banana eh a melhor!"; //tapioca banana
    dialogo[6] = "???: Deixa eu experimentar... Pao misto ta uma delicia!"; //pao misto
    dialogo[7] = "???: O pao ta gostosinho, mas a carne ta muito salgada..."; //pao carne
    

    //for(i=1;i<8;i++) printf("\nLinha %d: %s\n", i, cafedamanha[i]);

    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 4 || i == 5 || i == 6 || i == 7) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                //scanf("%d", &d);
                break;
        }   
    }

    for(j=0;j<8;j++) free(dialogo[j]);

    free(dialogo);


    printf("\n"); //scanf("%c", &entry); //IDEIA-------desacelerar o jogo-----REPETE-SE---
    //pode ser o enter


    char nomepassaro[20];
    int nome_ounao = 1; //presença de nome ou n
    //em outro momento da historia ele pergunta o nome

    printf("???: Ei, o que acha de me dar um nome? Seria mais legal!\n");

    dialogo = calloc(4, sizeof(char*));

    for(j=0;j<4;j++)dialogo[j] = calloc(1000, sizeof(char));

    dialogo[0] = "0";
    dialogo[1] = "(1) Eh realmente necessario?\n(2) Tudo bem...";
    dialogo[2] = "Ok, isso me machucou.";
    dialogo[3] = "Esse eh o espirito!";

    
    i = 1;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 2 || i == 3) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                nome_ounao = 0;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                break;
        }  
    }

    for(j=0;j<4;j++) free(dialogo[j]);

    free(dialogo);

    
    
    if(nome_ounao != 0){
        printf("???: Entao, qual vai ser meu nome?!\n");
        scanf("%*c"); //gab att
        scanf("%[^\n]", nomepassaro);

        //se houver presença de pelo menos um simbolo tem-se:
        while( VerificaCarac(nomepassaro) == 1 ){ //nomepassaro
            printf("???: Esse nome nao me parece apropriado, que tal tentar outro?\n");
            scanf("%*c"); //gab att
            scanf("%[^\n]", nomepassaro);
        }
        
        printf("%s: Ei! Tudo certo! Me sinto vivo. %s eh um otimo nome!\n", nomepassaro, nomepassaro);
    }
    else sprintf( nomepassaro, "???");


        printf("\n");//scanf("%c", &entry); //desacelerar o jogo
        //pode ser o enter
        

        printf("%s: Beleza, caro amigo, posso saber seu nome?\n");

    dialogo = calloc(4, sizeof(char*));

    for(j=0;j<4;j++)dialogo[j] = calloc(1000, sizeof(char));

    dialogo[0] = "0";
    dialogo[1] = "(1) Nao.\n(2) Ah... Claro...";
    dialogo[2] = "Voce me odeia?";
    dialogo[3] = "Yey!";

    char nomeprotag[20];

    int nome2_ounao = 1; //presença de nome ou n
    
    i = 1;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 2 || i == 3) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                nome2_ounao = 0;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
           default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                break;
        }  
    }

    for(j=0;j<4;j++) free(dialogo[j]);

    free(dialogo);


    if(d==2){
        printf("/---OBS: Lembre-se de colocar um nome masculino.---/\n"); //tem uma maneira mais sutil de relembrar isso?
        printf("Meu nome eh ");
        scanf("%*c");
        scanf("%[^\n]", nomeprotag);


        //se houver presença de pelo menos um simb no nome tem-se:
        while( VerificaCarac(nomeprotag) == 1 ){
            printf("???: Acho que seu nome nem existe ou sua mae te odeia, que tal tentar de novo?\n");
            scanf("%*c");
            scanf("%[^\n]", nomeprotag);
        }


        printf("%s: Wow! Nome legal, %s, hein?, queria que fosse o meu...\n", nomepassaro, nomeprotag);
    }
    else{
        printf("\n");
        printf("(O passaro olha ao redor de seu quarto e acaba encontrando uma carta assinada por voce)\n");

        printf("\n"); //scanf("%c", &entry); //desacelerar o jogo
        //pode ser o enter

        printf("/---OBS: Lembre-se de colocar um nome masculino.---/\n");
        printf("%s: Ei, olha so! Nao tem como escapar de mim. Seu nome eh... Calma, que letra dificil... Ok, seu nome eh...\n ", nomepassaro);
        scanf("%*c");
        scanf("%[^\n]", nomeprotag);


        while( VerificaCarac(nomeprotag) == 1 ){
            printf("???: Isso nao eh possivel, deixa eu reler... Seu nome eh...\n");
            scanf("%*c");
            scanf("%[^\n]", nomeprotag);
        }


        printf("%s: Aha! Ok, amigo %s, nao se preocupe. Nao vou te machucar\n", nomepassaro, nomeprotag);
    }


    printf("\n");


    printf("(Seu celular esta vibrando com seguidas notificacoes. Ao lado, ha seu livro aberto com um marcacor de pagina amassado. Com qual voce quer interagir?)\n");
    
    dialogo = calloc(8, sizeof(char*));

    for(j=0;j<8;j++) dialogo[j] = calloc(1000, sizeof(char));

    dialogo[0] = "Error: 0 is not an option."; 
    
    dialogo[1] = "(1) Celular\n(2) Livro aberto";

    dialogo[2] = "(Voce pega seu celular e percebe 8 chamadas de voz perdidas de um contato chamado \"Mae\". Oque voce faz?)\n(1) Retorna ligacao\n(2) Envia mensagem"; //celular

    dialogo[3] = "(Voce puxa o livro para perto de si, ainda aberto na mesma pagina.)\n(1) Ler o que esta escrito no marcador\n(2) Ler uma frase numa linha aleatoria da pagina"; // livro aberto

    dialogo[4] = "(Voce seleciona retornar ligacao para \"Mae\". O telefone toca... Toca... Mas ninguem atende.)\n";
    dialogo[5] = "(Voce abre o WhatsBird e vai direto para a conversa com \"Mae\", digitando a seguinte mensagem: \"Oi, mae, estou bem. Por que me ligou tantas vezes?\")";
    dialogo[6] = "(A frase lida no marcador foi: \"Sem prazer, nao ha vida. A luta pelo prazer encontra-se na luta pela vida.\")"; //o que esta no marcador
    dialogo[7] = "(A frase lida no livro foi: \"-Minha existencia comecava a me espantar seriamente. Nao seria eu uma simples aparencia?\")"; //frase aleatoria
    
    i = d = 1;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 4 || i == 5 || i == 6 || i == 7) break; //if(i == 5 || i == 6 || i == 7 || i == 8) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("Lembre-se que ha apenas a opcao 1 e 2\n");
                //scanf("%d", &d);
                break;
        }   
    }

    for(j=0;j<8;j++) free(dialogo[j]);

    free(dialogo);


    printf("\n");


    printf("%s: Nossa, voce esta com uma cara pessima.\n", nomepassaro);

    printf("\n");

    printf("(Ao olhar para o relogio voce imediatamente percebe seu atraso e ja imagina o esporro que vai levar do chefe...)\n");

    printf("\n");

    printf("%s: Ei, %s, certeza que voce quer ir ao trabalho? Quer dizer... Um dia nao vai fazer falta. Alem disso, voce nao quer levar um esporro do chefe, quer?\n", nomepassaro, nomeprotag);

    printf("(ESSA DECISAO TEM CONSEQUENCIAS. ESCOLHA COM SABEDORIA.)\n(1) Faltar ao trabalho\n(2) Ir ao trabalho\n");
    scanf("%d", &entry);

    printf("\n");
    
    if(entry == 1){ //FALTOU AO TRBALHO
        printf("Op 1\n");



        printf("The End\nObrigado(a) por jogar The Bird.\n");
        ImprimeCreditos();
        return 0;
    }
    else{ //FOI AO TRABALHO
        printf("Op 2\n");
    }
    

    printf("\n\n\n");

    printf("          THE END\nObrigado(a) por jogar The Bird.\n");
    ImprimeCreditos();


    //--------------DETALHES DA ATUALIZAÇÃO-------------//
    //DATA: 5/1
    //AUTOR(A): MARI
    //COMENTARIO DA ATUALIZAÇÃO: adicionei historia
    /*INCOMPLETO:
        Nao precisar de enter ao pressionar tecla ( fgets() to get the input text and then sscanf() on the result )
        ADD Arquivos
        ADD "functions.h" e "functions.c" (tem como add no github + de 1 arquivo)
        ADD Struct
    */
    /*IDEIAS:
        Dialogo anterior sumir (certeza?)
    */
    //-----------THANKS FOR YOU CONTRIBUTION-----------//

  return 0;
}

int VerificaCarac(char * str){
    int i, ops = 0;
   
    for(i=0; i < strlen(str); i++){
        //printf("%c", str[i]);
        if( ( (int)str[i] >= 0 && (int)str[i] <= 64 ) || ( (int)str[i] >= 91 && str[i] <= 96 ) || ( (int)str[i] >= 123) ){
            ops = 1;
            break;
        }
    }
    if(ops == 1) return 1;
    else return 0;
}

void ImprimeCreditos(){
    printf("\n\n      CREDITOS FINAIS    \n\n");
    printf("\nOferecimento(){ \n");
        printf("  Universidade Federal de Goias(UFG);\n");
        printf("}\n");


    printf("\nDevelopers(){ \n");
        printf("  Mariana \"Mari\" Santos;\n");
        printf("  Gabriel \"Gabs\" Lopes;\n");
        printf("}\n");

    printf("\nDesenvolvedores da historia(){ \n");
        printf("  Mariana \"Mari\" Santos;\n");
        printf("  Gabriel \"Gabs\" Lopes;\n");
        printf("}\n");

    printf("\nDiretores(){ \n");
        printf("  Mariana \"Mari\" Santos;\n");
        printf("  Gabriel \"Gabs\" Lopes;\n");
        
        printf("}\n");

    printf("\nEfeitos Sonoros(){ \n");
        printf("  Calma, isso nao deveria estar aqui;\n  return -1;\n");
        printf("}\n");

    printf("\nAgradecimentos Especiais(){ \n");
        printf("  Prof. Gustavo Teodoro Laureano;\n");
        printf("  Arnaldo \"Pai da Mari\" Santos;\n");
        printf("  Silene \"Mae da Mari\" Santos;\n");
        printf("  Tallya \"tlly\" Jesus;\n");
        printf("  Vitor \"Troloze\" Di Lorenzzi;\n");
        printf("  Gabriel \"Amyr\" Freitas;\n");
        printf("}\n");

    printf("\nsystem(\"The End\");\nreturn 0;\n\n");
}
