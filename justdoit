#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <locale.h>

int VerificaCarac(char * str);

void ImprimeCreditos(void);

/*
void LimpaDialogo(int tam, char **dialogo);

void CriaDialogo(int tam, char **dialogo);
*/

int main(){

    setlocale(LC_ALL, "");
    char entry;
    
    system("cls"); //limpa terminal

    printf("Os developers advertem: para uma melhor experiencia utilize o terminal em tela cheia.\n\n");
    printf("A mecanica eh bem simples, apenas nos dialogos com decisoes sera necessario pressionar a tecla \"Enter\" apos a escolha.\n");
    printf("Bom jogo!\nPressione qualquer tecla para continuar.\n");

    getch(); //recebe um caracter sem mostrar no terminal
    //getche(); //recebe um caracter e mostra no terminal

    system("cls");

    //passaro fala:
    printf("???: Ei, voce finalmente acordou.\n");
    getch();

    printf("???: Tudo bem, nao te esperei tanto assim.\n");
    getch();


    printf("\n");

    printf("???: Acho que estou com fome, que tal prepararmos alguma coisa?\n");
    //getch(); //?

    char **dialogo;
    int j;

    // aloca um vetor de LIN ponteiros para linhas
    dialogo = malloc(sizeof(char*)*5);

    // aloca um vetor com todos os elementos da matriz
    for(j=0;j<5;j++) dialogo[j]=malloc(sizeof(char)*1000);
    

    dialogo[0] = "0";
    dialogo[1] = "(1) Calmai! O que e voce?\n(2) Calmai! Quem e voce?";
    dialogo[2] = "???: Nossa, \"o que sou eu\"? Isso doeu...";
    dialogo[3] = "???: Bem... isso e complicado...";

    
    int i = 1, d;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 2 || i == 3) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                //getch(); // melhor nao
                break;
        }
               

    }
        for(j=0;j<5;j++)free(dialogo[j]);
        free(dialogo);
    


    i = d = 1;

    printf("???: Por enquanto, sou apenas um passaro que ira te acompanhar em sua jornada.\n");
    getch();


    dialogo = calloc(8, sizeof(char*));
    for(j=0;j<8;j++)dialogo[j] = calloc(1000, sizeof(char));

    dialogo[0] = "0"; 
    dialogo[1] = "???: Mas entao, vamos fazer (1)tapioca ou (2)pao?"; 
    dialogo[2] = "???: Hum, ok, tapioca com (1)presunto e queijo ou (2)banana?"; //tapioca
    dialogo[3] = "???: Pao! Adoro! (1)Presunto e queijo ou com (2)carne?"; //pao
    dialogo[4] = "???: Deixa eu experimentar... Tapioca com presunto e queijo ta muito boa!"; //tapioca p. e q.
    dialogo[5] = "???: Tapioca com banana eh a melhor!"; //tapioca banana
    dialogo[6] = "???: Deixa eu experimentar... Pao misto ta uma delicia!"; //pao misto
    dialogo[7] = "???: O pao ta gostosinho, mas a carne ta muito salgada..."; //pao carne
    

    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 4 || i == 5 || i == 6 || i == 7) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                //getch();
                break;
        }   
    }

    for(j=0;j<8;j++) free(dialogo[j]);
    free(dialogo);

    getch();
    printf("\n"); //scanf("%c", &entry); //IDEIA-------desacelerar o jogo-----REPETE-SE---
    //pode ser o enter


    char nomepassaro[20];

    printf("???: Ei, o que acha de me dar um nome? Seria mais legal!\n");
    //getch();

    dialogo = calloc(4, sizeof(char*));

    for(j=0;j<4;j++)dialogo[j] = calloc(1000, sizeof(char));

    dialogo[0] = "0";
    dialogo[1] = "(1) Eh realmente necessario?\n(2) Tudo bem...";
    dialogo[2] = "Ok, isso me machucou.";
    dialogo[3] = "Esse eh o espirito!";

    
    i = 1;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 2 || i == 3) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                //nome_ounao = 0;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                break;
        }  
    }

    for(j=0;j<4;j++) free(dialogo[j]);

    free(dialogo);

    getch();

    
    
    if(d == 2){
        printf("???: Entao, qual vai ser meu nome?!\n");
        scanf("%*c"); //gab att
        scanf("%[^\n]", nomepassaro);

        //se houver presença de pelo menos um simbolo tem-se:
        while( VerificaCarac(nomepassaro) == 1 ){ //nomepassaro
            printf("???: Esse nome nao me parece apropriado, que tal tentar outro?\n");
            scanf("%*c"); //gab att
            scanf("%[^\n]", nomepassaro);
        }
        
        printf("%s: Ei! Tudo certo! Me sinto vivo. %s eh um otimo nome!\n", nomepassaro, nomepassaro);
        getch();
    }
    else sprintf( nomepassaro, "???");

    //getch();
    printf("\n");
        

    printf("%s: Beleza, caro amigo, posso saber seu nome?\n", nomepassaro);
    //getch();

    dialogo = calloc(4, sizeof(char*));

    for(j=0;j<4;j++)dialogo[j] = calloc(1000, sizeof(char));

    dialogo[0] = "0";
    dialogo[1] = "(1) Nao.\n(2) Ah... Claro...";
    dialogo[2] = "Voce me odeia?";
    dialogo[3] = "Yey!";

    char nomeprotag[20];

    i = 1;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 2 || i == 3) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
           default: //diff de 1 ou 2
                printf("???: Nao entendi.\nLembre-se que ha apenas a opcao 1 e 2\n");
                break;
        }  
    }

    for(j=0;j<4;j++) free(dialogo[j]);

    free(dialogo);


    if(d==2){
        printf("/---OBS: Lembre-se de colocar um nome masculino.---/\n"); //tem uma maneira mais sutil de relembrar isso?
        printf("Meu nome eh ");
        scanf("%*c");
        scanf("%[^\n]", nomeprotag);


        //se houver presença de pelo menos um simb no nome tem-se:
        while( VerificaCarac(nomeprotag) == 1 ){
            printf("???: Acho que seu nome nem existe ou sua mae te odeia, que tal tentar de novo?\n");
            scanf("%*c");
            scanf("%[^\n]", nomeprotag);
        }


        printf("%s: Wow! Nome legal, %s, hein?, queria que fosse o meu...\n", nomepassaro, nomeprotag);
        //getch();
    }
    else{
        printf("\n");
        printf("(O passaro olha ao redor de seu quarto e acaba encontrando uma carta assinada por voce)\n");

        getch();
        printf("\n");

        printf("/---OBS: Lembre-se de colocar um nome masculino.---/\n");
        printf("%s: Ei, olha so! Nao tem como escapar de mim. Seu nome eh... Calma, que letra dificil... Ok, seu nome eh...\n ", nomepassaro);
        scanf("%*c");
        scanf("%[^\n]", nomeprotag);


        while( VerificaCarac(nomeprotag) == 1 ){
            printf("???: Isso nao eh possivel, deixa eu reler... Seu nome eh...\n");
            scanf("%*c");
            scanf("%[^\n]", nomeprotag);
        }


        printf("%s: Aha! Ok, amigo %s, nao se preocupe. Nao vou te machucar\n", nomepassaro, nomeprotag);
        //getch();
    }
    getch();


    printf("\n");


    printf("(Seu celular esta vibrando com seguidas notificacoes. Ao lado, ha seu livro aberto com um marcador vermelho escrito alguma frase. O que voce quer fazer?)\n");
    //getch();
    
    dialogo = calloc(8, sizeof(char*));

    for(j=0;j<8;j++) dialogo[j] = calloc(1000, sizeof(char));

    dialogo[0] = "Error: 0 is not an option."; 
    
    dialogo[1] = "(1) Ver o celular\n(2) Pegar o livro aberto";

    dialogo[2] = "(Voce pega seu celular e percebe 8 chamadas de voz perdidas de um contato chamado \"Mae\". O que voce faz?)\n(1) Retorna ligacao\n(2) Envia mensagem"; //celular

    dialogo[3] = "(Voce puxa o livro para perto de si, ainda aberto na mesma pagina.)\n(1) Ler o que esta escrito no marcador\n(2) Ler uma frase numa linha aleatoria da pagina"; // livro aberto

    dialogo[4] = "(Voce seleciona retornar ligacao para \"Mae\". O telefone toca... Toca... Mas ninguem atende.)\n";
    dialogo[5] = "(Voce abre o WhatsBird e vai direto para a conversa com \"Mae\", digitando a seguinte mensagem: \"Oi, mae, estou bem. Por que me ligou tantas vezes?\")";
    dialogo[6] = "(A frase lida no marcador foi: \"Sem prazer, nao ha vida. A luta pelo prazer encontra-se na luta pela vida.\")"; //o que esta no marcador
    dialogo[7] = "(A frase lida no livro foi: \"-Minha existencia comecava a me espantar seriamente. Nao seria eu uma simples aparencia?\")"; //frase aleatoria
    
    i = d = 1;
    while(i != 0){
        printf("%s\n", dialogo[i]);
        if(i == 4 || i == 5 || i == 6 || i == 7) break; //if(i == 5 || i == 6 || i == 7 || i == 8) break;
        scanf("%d", &d);

        switch (d){
            case 1:
                i = i*2;
                break;

            case 2:
                i = i*2 + 1;
                break;
        
            default: //diff de 1 ou 2
                printf("Lembre-se que ha apenas a opcao 1 e 2\n");
                //scanf("%d", &d);
                break;
        }   
    }

    for(j=0;j<8;j++) free(dialogo[j]);

    free(dialogo);


    printf("\n");


    printf("%s: Nossa, voce esta com uma cara pessima.\n", nomepassaro);

    getch();
    printf("\n");

    printf("(Ao olhar para o relogio voce imediatamente percebe seu atraso e ja imagina o esporro que vai levar do chefe...)\n");

    getch();
    printf("\n");

    printf("%s: Ei, %s, certeza que voce quer ir ao trabalho? Quer dizer... Um dia nao vai fazer falta. Alem disso, voce nao quer levar um esporro do chefe, quer?\n", nomepassaro, nomeprotag);
    getch();

    printf("(ESSA DECISAO TEM CONSEQUENCIAS.)\n(1) Faltar ao trabalho\n(2) Ir ao trabalho\n");

    int trab;
    scanf("%d", &trab);

    printf("\n");
    
    if(trab == 1){ //---------------------------------------------------------------FALTOU AO TRABALHO-------------------------------------------------------------------
        printf("%s: Ei, %s, tudo bem. Deve ser o melhor para voce. Vamos arranjar algo para passar o tempo.\n", nomepassaro, nomeprotag);
        getch();

        printf("(Voce olha ao redor de seu quarto desorganizado, entao percebe seu velho violao empoeirado apoiado na parede, e uma foto com pessoas em um porta-retrato branco em cima de sua escrivaninha.)\n");
        //getch();

        dialogo = calloc(8, sizeof(char*));

        for(j=0;j<8;j++) dialogo[j] = calloc(1000, sizeof(char));

        dialogo[0] = "Error: '0' is not an option."; 
    
        dialogo[1] = "(1) Mexer no violao \n(2) Investigar retrato";

        dialogo[2] = "(Voce pega seu violao. Tem tanta poeira que te faz espirrar por 2 minutos seguidos. Que musica tocar? \n(1) Seafret - Be There\n(2) Coldplay - Fix you"; //violao

        dialogo[3] = "(Voce pega o retrato em suas maos. Sem duvida, uma linda paisagem da praia. Reconhece seus pais, voce e seu irmao mais velho ao seu lado. Estranhamente, voce nao se lembra dessa viagem.)\n(1) Recordar o irmao\n(2) Recordar a mae"; //retrato

        dialogo[4] = "I lost everything.\nI threw myself in and you took me.\nWhere no one was there...\n"; //be there
        dialogo[5] = "And the tears come streaming down your face.\nWhen you lose something, you can't replace.\nWhen you love someone, but it goes to waste.\nCould it be worse?"; //coldplay
        dialogo[6] = "(Seu irmao mais velho morreu ha quatro anos. Acidente de carro. Desde entao, sua mae nunca mais foi a mesma e seu pai fugiu de casa.)"; //irmao
        dialogo[7] = "(Sua mae era doce e divertida... ate a morte prematura de seu irmao mais velho. Acidente de carro. Seus pais nunca mais foram os mesmos desde entao)"; // mae
    
        i = d = 1;

        int violao;
        while(i != 0){
            if(i == 2) violao = 1; //unico
            printf("%s\n", dialogo[i]);
            if(i == 4 || i == 5 || i == 6 || i == 7) break; //if(i == 5 || i == 6 || i == 7 || i == 8) break;
            scanf("%d", &d);

            switch (d){
            case 1:
            i = i*2;
            break;

            case 2:
            i = i*2 + 1;
            break;
        
            default: //diff de 1 ou 2
            printf("Lembre-se que ha apenas a opcao 1 e 2\n");
            //scanf("%d", &d);
            break;
            }   
        }   

        for(j=0;j<8;j++) free(dialogo[j]);
        free(dialogo);

        if(violao == 1){ //decidiu interagir com o violao (nao sabe do irmao)
            printf("%s: Faz tempo que voce nao toca, ne? Mas tudo bem, eh uma bela musica.\nQue tal ver o retrato agora?\n", nomepassaro);
            getch();

            printf("(Voce pega o retrato em suas maos. Sem duvida, uma linda paisagem da praia. Reconhece seus pais, voce e seu irmao mais velho ao seu lado. Estranhamente, voce nao se lembra dessa viagem.)\n(1) Recordar o irmao\n(2) Recordar a mae\n"); //retrato
            scanf("%d", &i);

            if(i == 1) printf("%s: Seu irmao mais velho morreu ha quatro anos. Acidente de carro. Desde entao, sua mae nunca mais foi a mesma e seu pai fugiu de casa, lembra?\n", nomepassaro);
            else{
                printf("%s: Sua mae era doce e divertida. Voce se recorda dos momentos com ela... As risadas...\n", nomepassaro);
                getch();
                printf("%s: Ela era feliz ate a morte prematura de seu primeiro filho, Samuel. Infeliz acidente de carro. Seu irmao sempre foi protetor...\n", nomepassaro);
                getch();
                printf("%s: Voce se lembra quando queria brincar na rua, mas ele tinha medo que voce se machucasse?\n", nomepassaro);
                getch();
            }
            
        }

        printf("%s: Eu sinto muito, %s. Sei que se sente culpado. Eu entendo sua vontade de querer voltar ao passado e fazer tudo diferente.\n", nomepassaro, nomeprotag);
        getch();
        printf("%s: Parece que... O presente eh uma prisao, nao eh, %s?\n", nomepassaro, nomeprotag);
        getch();
        printf("%s: Me diz, voce acha que sua mae realmente se importa com voce? Ou apenas age por egoismo pois nao quer perder outro filho e ficar pior ainda?\n", nomepassaro);
        getch();
        printf("%s: ...\n", nomepassaro);
        getch();
        printf("%s: Eu sei, nao eh facil pensar nisso. Mas, veja, seu pai nao aguentou e fugiu... E sua mae se enfiou na cama, sem coragem de levantar.\n", nomepassaro);
        getch();
        printf("%s: Diga-me, %s, voce se sente amado?\n", nomepassaro, nomeprotag);

        printf("(1) Sim\n(2) Nao\n");
        scanf("%d", &d);


        if(d == 1){//sim
            printf("%s: Sim, eu me sinto amado. Minha mae se importa comigo, nada do que voce falou eh real! PARA COM ISSO!\n", nomeprotag);
            getch();

            printf("%s: Eu sinto pena de voce, %s, nao ve que essa luta ja acabou?\n", nomepassaro, nomeprotag);
            getch();

            printf("%s: Voce nem sequer lembra da ultima vez que escutou a voz de sua mae. Seu passado eh um branco total. VOCE SE ESQUECEU DE TUDO QUE TE MANTINHA VIVO!\n", nomepassaro);
            getch();

            printf("%s: Quando sua vitalidade comecou a se suprimir?\n", nomepassaro);
            getch();

            printf("%s: Quando foi a ultima vez que se sentiu vivo, %s?\n", nomepassaro, nomeprotag);
            getch();

            printf("%s: Eu sei o quanto voce quer resistir a isso, a mim, %s. Mas nao ha mais volta. Voce ja foi tomado por esse sentimento de vazio e impotencia ha muito tempo.\n", nomepassaro, nomeprotag);
            getch();

            printf("%s: Mas, ei, nao tem problema. Tudo tem solucao, certo?\n", nomepassaro);
            getch();

            printf("(%s te entrega diversas pilulas e comprimidos.)\n", nomepassaro);
            getch();

            printf("%s: Isso vai te curar totalmente, confie em mim.\n", nomepassaro);
            getch();

        }
        else{ //nao
            printf("%s: Nao... Realmente... Agora que voce falou, parece que tudo ficou mais claro...\n", nomeprotag);
            getch();

            printf("%s: Sim, eu estou certo, nao eh? Sua existencia realmente nao importa.\n", nomepassaro);
            getch();

            printf("%s: Mas nao se preocupe, isso logo vai passar. Tome.\n", nomepassaro);
            getch();

            printf("(%s te entrega diversas pilulas e comprimidos.)\n", nomepassaro);
            getch();

            printf("%s: Isso vai acabar com meu sofrimento? Minha dor? Minha culpa? Tudo isso? Eu nao aguento mais...\n", nomeprotag);
            getch();

            printf("%s: Sim, vai te curar totalmente, confie em mim. Isso vai acabar logo.\n", nomepassaro);
            getch();

        }

        printf("(Voce engole todas as pilulas e comprimidos esperando que a dor passe.)\n");
        getch();

        printf("%s: Vai ficar tudo bem...\n", nomepassaro);
        getch();

        printf("\n\n");

        printf("(A depressao te venceu aqui. Nao deixe ela te vencer na vida. Ligue 188.)\n");
        getch();

        ImprimeCreditos();
        return 0;
    }
    else{ //FOI AO TRABALHO
        printf("%s: Tudo bem, voce quem sabe.\n", nomepassaro);
        getch();

        printf("(Voce se veste para o trabalho enquanto se olha no espelho, percebendo que nao se encontra em boa forma.)\n");
        getch();

        printf("%s: Sua olheiras estao maiores? Voce nao anda dormindo bem, ne?\n", nomepassaro);
        getch();

        printf("(Voce pega suas coisas e segue a caminho do trabalho.)\n");
        getch();

        printf("(Algum tempo depois...)\n");
        getch();

        //chefe reclama do atraso dele novamente
        //ele fala com a garota que gosta ou nao?
        //ao final do expediente ele eh demitido
        //chega em casa
        //toma antidepressivo? (passaro diz que eh veneno, paranoia)
        //se tomar, sobrevive (jogo acaba)
        //se nao, comeca a ter ilusoes e se mata
        //fim do jogo
    }
    
    ImprimeCreditos();


    //--------------DETALHES DA ATUALIZAÇÃO-------------//
    //DATA: 5/1
    //AUTOR(A): MARI
    //COMENTARIO DA ATUALIZAÇÃO: adicionei historia e getch()
    /*INCOMPLETO:
        Nao precisar de enter ao pressionar tecla ( fgets() to get the input text and then sscanf() on the result )
        ADD Arquivos
        ADD "functions.h" e "functions.c" (tem como add no github + de 1 arquivo)
        ADD Struct
    */
    /*IDEIAS:
        Dialogo anterior sumir
        o restante da historia esta comentado na parte em que ele escolhe ir ao trabalho
    */
    //-----------THANKS FOR YOU CONTRIBUTION-----------//

  return 0;
}

int VerificaCarac(char * str){
    int i, ops = 0;
   
    for(i=0; i < strlen(str); i++){
        //printf("%c", str[i]);
        if( ( (int)str[i] >= 0 && (int)str[i] <= 64 ) || ( (int)str[i] >= 91 && str[i] <= 96 ) || ( (int)str[i] >= 123) ){
            ops = 1;
            break;
        }
    }
    if(ops == 1) return 1;
    else return 0;
}

/*
void CriaDialogo(int tam, char **dialogo){
    int j;

    dialogo = calloc(8, sizeof(char*));

    for(j=0;j<tam;j++) dialogo[j] = calloc(1000, sizeof(char));
}

void LimpaDialogo(int tam, char **dialogo){
    int j;

    for(j=0;j<tam;j++) free(dialogo[j]);

    free(dialogo);
}
*/


void ImprimeCreditos(){
    printf("\n\n\n");

    printf("          THE END\nObrigado(a) por jogar The Bird.\n");

    printf("\n\n      CREDITOS FINAIS    \n\n");
    printf("\nOferecimento(){ \n");
        printf("  Universidade Federal de Goias(UFG);\n");
        printf("}\n");


    printf("\nDevelopers(){ \n");
        printf("  Mariana \"Mari\" Santos;\n");
        printf("  Gabriel \"Gabs\" Lopes;\n");
        printf("}\n");

    printf("\nDesenvolvedores da historia(){ \n");
        printf("  Mariana \"Mari\" Santos;\n");
        printf("  Gabriel \"Gabs\" Lopes;\n");
        printf("}\n");

    printf("\nDiretores(){ \n");
        printf("  Mariana \"Mari\" Santos;\n");
        printf("  Gabriel \"Gabs\" Lopes;\n");
        printf("}\n");

    printf("\nEfeitos Sonoros(){ \n");
        printf("  Calma, isso nao deveria estar aqui;\n  return -1;\n");
        printf("}\n");

    printf("\nAgradecimentos Especiais(){ \n");
        printf("  Prof. Gustavo Teodoro Laureano;\n");
        printf("  Arnaldo \"Pai da Mari\" Santos;\n");
        printf("  Silene \"Mae da Mari\" Santos;\n");
        printf("  Arthur \"Paraiba\" Ximenes;\n");
        printf("  Tallya \"tlly\" Jesus;\n");
        printf("  Vitor \"Troloze\" Di Lorenzzi;\n");
        printf("  Gabriel \"Amyr\" Freitas;\n");
        printf("  Luigi \"Brav0k\" Gontijo;\n");
        printf("  Marcelo \"Irmao do Luigi\" Gontijo;\n");
        printf("  Joao Pedro \"Jao\" Silva;\n");
        
        printf("}\n");

        printf("\n2020-2021\n");

    printf("\nsystem(\"The End\");\nreturn 0;\n\n");
}
